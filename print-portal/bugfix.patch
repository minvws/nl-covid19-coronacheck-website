From cfa6b3049e42d8a1d5204db8c745841236459e53 Mon Sep 17 00:00:00 2001
From: 5upr3m0 <remo@egeniq.com>
Date: Thu, 22 Sep 2022 11:35:38 +0200
Subject: [PATCH 1/2] TAIGA-4872: copy: update

---
 print-portal/src/data/language/dictionaries/en.json | 2 +-
 print-portal/src/data/language/dictionaries/nl.json | 2 +-
 2 files changed, 2 insertions(+), 2 deletions(-)

diff --git a/print-portal/src/data/language/dictionaries/en.json b/print-portal/src/data/language/dictionaries/en.json
index 2ec5e22d..b907c5b9 100644
--- a/print-portal/src/data/language/dictionaries/en.json
+++ b/print-portal/src/data/language/dictionaries/en.json
@@ -672,7 +672,7 @@
             "button": "Yes, next",
             "link": "No, a vaccination is missing",
             "pageHeader": "Are these all your vaccinations?",
-            "pageIntro": "<p>We retrieved these vaccinations from the GGD and the RIVM:<\/p>"
+            "pageIntro": "<p>Continue to add these vaccinations to your certificate. Or add another vaccination.<\/p>"
         },
         "provideCode": {
             "didNotGetCode": "Didn't receive a verification code?",
diff --git a/print-portal/src/data/language/dictionaries/nl.json b/print-portal/src/data/language/dictionaries/nl.json
index f919b447..65e22db7 100644
--- a/print-portal/src/data/language/dictionaries/nl.json
+++ b/print-portal/src/data/language/dictionaries/nl.json
@@ -672,7 +672,7 @@
             "button": "Ja, volgende",
             "link": "Nee, er mist een vaccinatie",
             "pageHeader": "Zijn dit al jouw vaccinaties?",
-            "pageIntro": "<p>Deze vaccinaties hebben we opgehaald bij de GGD en het RIVM:<\/p>"
+            "pageIntro": "<p>Ga verder om deze vaccinaties mee te nemen in je bewijs of voeg nog een vaccinatie toe.<\/p>"
         },
         "provideCode": {
             "didNotGetCode": "Geen verificatiecode gekregen?",
-- 
2.24.3 (Apple Git-128)


From 52fa6a2e629b2fbf93e9bc9b41d7a65cc8d62bf7 Mon Sep 17 00:00:00 2001
From: 5upr3m0 <remo@egeniq.com>
Date: Mon, 26 Sep 2022 13:02:24 +0200
Subject: [PATCH 2/2] TAIGA-4607: feat(proofs): show positive tests

---
 .../3-collect/_shared/redirect-mixin.vue      | 19 +++++++++++++++----
 .../recovery/happy/ProofsOverviewList.vue     |  8 ++++++--
 print-portal/src/store/index.js               |  6 +++++-
 .../src/store/modules/signedEvents.js         |  7 ++++++-
 4 files changed, 32 insertions(+), 8 deletions(-)

diff --git a/print-portal/src/components/views/3-collect/_shared/redirect-mixin.vue b/print-portal/src/components/views/3-collect/_shared/redirect-mixin.vue
index 4130b226..d7a80c79 100644
--- a/print-portal/src/components/views/3-collect/_shared/redirect-mixin.vue
+++ b/print-portal/src/components/views/3-collect/_shared/redirect-mixin.vue
@@ -308,10 +308,21 @@ export default {
             return true
         },
         handleWithPositiveTest () {
-            // no recovery is fetched, or expired, remove signed events and show a warning
-            this.$store.dispatch('signedEvents/clear', { filter: this.filter, scope: this.scope })
-            const { auth } = this
-            this.$router.replace({ name: this.pages.overview, params: { auth, message: this.$t('warning.noPositivetest') } });
+            const { auth, filter, scope } = this
+            let message = this.$t('warning.noPositivetest')
+
+            if (this.$store.getters.removeExpiredPositiveTestsWithPositiveTest) {
+                // no recovery is fetched, or expired, remove signed events and show a warning
+                this.$store.dispatch('signedEvents/clear', { filter, scope })
+            } else {
+                // see #TAIGA-4532: always include positive-test
+                const proofs = this.$store.getters['signedEvents/getProofsWithFilterAndScope']({ filter, scope });
+                if (proofs.length) {
+                    message = undefined;
+                }
+            }
+
+            this.$router.replace({ name: this.pages.overview, params: { auth, message } });
         },
         isTestedPositiveBeforeFirstVaccination (proofEvents) {
             // all positive tests dates
diff --git a/print-portal/src/components/views/3-collect/recovery/happy/ProofsOverviewList.vue b/print-portal/src/components/views/3-collect/recovery/happy/ProofsOverviewList.vue
index 07c0cfff..be77af04 100644
--- a/print-portal/src/components/views/3-collect/recovery/happy/ProofsOverviewList.vue
+++ b/print-portal/src/components/views/3-collect/recovery/happy/ProofsOverviewList.vue
@@ -88,14 +88,18 @@ export default Vue.extend({
         },
         events () {
             const events = this.$store.getters['signedEvents/getProofEvents']('all');
-            return events.map(item => {
+            const result = events.map(item => {
                 const tag = item.event.type
                 return {
                     ...item,
                     tag
                 }
             })
-                .filter(({ event: { vaccination } }) => !!vaccination) // only show vaccinations, see #TAIGA-4607
+            if (!this.$store.getters.removeExpiredPositiveTestsWithPositiveTest) {
+                // show all results, see #TAIGA-4532
+                return result
+            }
+            return result.filter(({ event: { vaccination } }) => !!vaccination) // only show vaccinations, see #TAIGA-4607
         }
     }
 })
diff --git a/print-portal/src/store/index.js b/print-portal/src/store/index.js
index 71232480..5b33f287 100644
--- a/print-portal/src/store/index.js
+++ b/print-portal/src/store/index.js
@@ -30,7 +30,8 @@ const state = {
     slotModalActive: false,
     vaccinationWithPositiveTestEnabled: true, // when true, show a consent and hide all faq's,
     showListBeforeOverview: true, // will show a list of proofs before an overview page
-    flow: '' // vaccination | recovery
+    flow: '', // vaccination | recovery,
+    removeExpiredPositiveTestsWithPositiveTest: false // see TAIGA--4532
 };
 
 const getters = {
@@ -52,6 +53,9 @@ const getters = {
     vaccinationWithPositiveTestEnabled: ({ vaccinationWithPositiveTestEnabled }) => {
         return vaccinationWithPositiveTestEnabled
     },
+    removeExpiredPositiveTestsWithPositiveTest: ({ removeExpiredProofsWithPositiveTest }) => {
+        return removeExpiredProofsWithPositiveTest
+    },
     is0G: (state, { disclosurePolicies }) => {
         // 0G when disclosurePolicies = []
         return Array.isArray(disclosurePolicies) && !disclosurePolicies.length
diff --git a/print-portal/src/store/modules/signedEvents.js b/print-portal/src/store/modules/signedEvents.js
index 2d5bedef..50d8405e 100644
--- a/print-portal/src/store/modules/signedEvents.js
+++ b/print-portal/src/store/modules/signedEvents.js
@@ -52,12 +52,17 @@ const getters = {
         return proofEvents;
     },
     all: ({ all, coupling }) => {
-        return [...coupling, ...all.map(({ payload, signature }) => {
+        return [...coupling, ...all.map(({ payload, signature, ...lala }) => {
             return {
                 payload,
                 signature
             }
         })]
+    },
+    getProofsWithFilterAndScope: ({ all }) => ({ filter, scope } = {}) => {
+        return all.filter(event => {
+            return event.filter === filter && event.scope === scope;
+        })
     }
 };
 
-- 
2.24.3 (Apple Git-128)

