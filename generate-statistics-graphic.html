<!DOCTYPE html>
<html lang="en">
<head>
    <link href="/css/main.css" rel="stylesheet">

    <style>textarea { width: 100%; height: 100%; } hr { margin: 20px 0 } input { text-align: right; font-family: 'courier' }</style>

    <link rel="preload" as="font" href="/fonts/ROsanswebtextregular.woff2" type="font/woff2" crossorigin="anonymous">
    <link rel="preload" as="font" href="/fonts/ROsanswebtextregular.woff" type="font/woff2" crossorigin="anonymous">
    <link rel="preload" as="font" href="/fonts/ROsanswebtextbold.woff" type="font/woff"  crossorigin="anonymous">
    <link rel="preload" as="font" href="/fonts/montserrat-v15-latin_cyrillic-ext_cyrillic-700.woff2" type="font/woff"  crossorigin="anonymous">

    <link href="/img/favicon.ico" rel="shortcut icon" type="image/x-icon">
</head>
<body>
    <!-- use this page (locally) to generate graphics for the statistics page -->
    <!-- to use, disable exclusion in _config.yml at line 162, 
         and restart jekyll in your commandline.
         You can then find this page at 
         http://localhost:4000/generate-statistics-graphic.html .
        You only need to update the two arrays starting around line 65 of this document. 
        Then, copy the SVG codes to (respectively)
        - coronacheck-stats.svg
        - coronacheck-stats-en.svg
        - coronacheck-scanner-stats.svg
        - coronacheck-scanner-stats-en.svg
        And update the download number, tables and date in 
        - layouts/statistics.html
        - layouts/statistics-en.html
    -->

    <section class="container content-block">
        <h1>Generated SVG's</h1>
        <h2>CoronaCheck Downloads</h2>
        <div class="column-2">
            <div id="CoronaCheck_downloads_plot"></div>
            <div>
                <textarea id="CoronaCheck_downloads_plot_code"></textarea>
            </div>
        </div>
        <h2>CoronaCheck Scanner Downloads</h2>
        <div class="column-2">
            <div id="CoronaCheckScanner_downloads_plot"></div>
            <div>
                <textarea id="CoronaCheckScanner_downloads_plot_code"></textarea>
            </div>
        </div>

        <hr />

        <h2>CoronaCheck Downloads (English)</h2>
        <div class="column-2">
            <div id="CoronaCheck_downloads_plot_en"></div>
            <div>
                <textarea id="CoronaCheck_downloads_plot_en_code"></textarea>
            </div>
        </div>
        <h2>CoronaCheck Scanner Downloads (English)</h2>
        <div class="column-2">
            <div id="CoronaCheckScanner_downloads_plot_en"></div>
            <div>
                <textarea id="CoronaCheckScanner_downloads_plot_en_code"></textarea>
            </div>
        </div>
    </section>

    <!-- for generating the graphs, we use https://observablehq.com/@observablehq -->
    <script src="https://cdn.jsdelivr.net/npm/d3@7"></script>
    <script src="https://cdn.jsdelivr.net/npm/@observablehq/plot@0.2"></script>
    <script type="text/javascript" src="js/statistics/coronacheck-downloads.js"></script>
    <script type="text/javascript" src="js/statistics/scanner-downloads.js"></script>

    <script>
        // Dutch statistics
        CoronaCheck_downloads_plot = document.getElementById('CoronaCheck_downloads_plot');
        CoronaCheck_downloads_plot_code = document.getElementById('CoronaCheck_downloads_plot_code');
        CoronaCheckScanner_downloads_plot = document.getElementById('CoronaCheckScanner_downloads_plot');
        CoronaCheckScanner_downloads_plot_EN = document.getElementById('CoronaCheckScanner_downloads_plot_en');

        // English statistics
        CoronaCheck_downloads_plot_EN = document.getElementById('CoronaCheck_downloads_plot_en');
        CoronaCheck_downloads_plot_EN_code = document.getElementById('CoronaCheck_downloads_plot_en_code');
        CoronaCheckScanner_downloads_plot_EN = document.getElementById('CoronaCheckScanner_downloads_plot_en');
        CoronaCheckScanner_downloads_plot_EN_code = document.getElementById('CoronaCheckScanner_downloads_plot_en_code');

        const firstEntry = new Date(2021,03,28);
        const today = new Date();
        const thisMonthYear = today.toLocaleString("nl", { "month": "numeric" }) + today.toLocaleString("nl", { "year": "numeric" });
        const thisMonthNumber = parseInt(today.toLocaleString("nl", { "month": "numeric" }));
        const nextMonth = thisMonthNumber + 1;
        const nextMonthString = nextMonth.toString() + today.toLocaleString("nl", { "year": "numeric" }); 

        CoronaCheck_downloads_plot.appendChild(
            Plot.plot({
            marginBottom: 80,
            marginTop: 40,
            x: { 
                label: "Maand →",
                tickRotate: -45,
                tickFormat: (
                    (f) => {
                        const date = f.toLocaleString("nl", { "month": "short", "year": "numeric" });
                        const monthYear = f.toLocaleString("nl", { "month": "numeric" }) + f.toLocaleString("nl", { "year": "numeric" });
                        return monthYear === thisMonthYear ? `${date} *` : date;
                    }
                ),
                ticks: d3.utcMonth.every(1),
            },
            y: {
                label: "↑ Aantal downloads CoronaCheck (miljoen)",  
                labelOffset: -20,   
                transform: d => d / 1000000,
                grid: true,
                tickFormat: (f => `${f}M`),
                domain: [0, 18],
            },
            marks: [
                Plot.line(CC_downloads_plot, {
                    x: "date", 
                    y: "downloads",
                    stroke: "#ec025f",
                    strokeWidth: 3
                }),
                Plot.ruleY([0]),
            ],
        })
        );

        CoronaCheck_downloads_plot_EN.appendChild(
            Plot.plot({
            marginBottom: 80,
            marginTop: 40,
            x: { 
                label: "Month →",
                tickRotate: -45,
                tickFormat: (
                    (f) => {
                        const date = f.toLocaleString("en", { "month": "short", "year": "numeric" });
                        const monthYear = f.toLocaleString("nl", { "month": "numeric" }) + f.toLocaleString("nl", { "year": "numeric" });
                        return monthYear === thisMonthYear ? `${date} *` : date;
                    }
                ),
                ticks: d3.utcMonth.every(1),
            },
            y: {
                label: "↑ Number of downloads CoronaCheck (million)",  
                labelOffset: -20,   
                transform: d => d / 1000000,
                grid: true,
                tickFormat: (f => `${f}M`),
                domain: [0, 18],
            },
            marks: [
                Plot.line(CC_downloads_plot, {
                    x: "date", 
                    y: "downloads",
                    stroke: "#ec025f",
                    strokeWidth: 3
                }),
                Plot.ruleY([0]),
            ],
        }));

        CoronaCheckScanner_downloads_plot.appendChild(
            Plot.plot({
            marginBottom: 80,
            marginTop: 40,
            x: { 
                label: "Maand →",
                tickRotate: -45,
                tickFormat: (
                    (f) => {
                        const date = f.toLocaleString("nl", { "month": "short", "year": "numeric" });
                        const monthYear = f.toLocaleString("nl", { "month": "numeric" }) + f.toLocaleString("nl", { "year": "numeric" });
                        return monthYear === thisMonthYear ? `${date} *` : date;
                    }
                ),
                ticks: d3.utcMonth.every(1),
            },
            y: {
                label: "↑ Aantal downloads CoronaCheck Scanner (miljoen)",  
                labelOffset: -20,   
                transform: d => d / 1000000,
                grid: true,
                tickFormat: (f => `${f}M`),
                domain: [0, 4],
            },
            marks: [
                Plot.line(CCScanner_downloads_plot, {
                    x: "date", 
                    y: "downloads",
                    stroke: "#ec025f",
                    strokeWidth: 3
                }),
                Plot.ruleY([0]),
            ],
        })
        );

        CoronaCheckScanner_downloads_plot_EN.appendChild(
            Plot.plot({
            marginBottom: 80,
            marginTop: 40,
            x: { 
                label: "Maand →",
                tickRotate: -45,
                tickFormat: (
                    (f) => {
                        const date = f.toLocaleString("en", { "month": "short", "year": "numeric" });
                        const monthYear = f.toLocaleString("nl", { "month": "numeric" }) + f.toLocaleString("nl", { "year": "numeric" });
                        return monthYear === thisMonthYear ? `${date} *` : date;
                    }
                ),
                ticks: d3.utcMonth.every(1),
            },
            y: {
                label: "↑ Number of downloads CoronaCheck Scanner (million)",   
                labelOffset: -20,   
                transform: d => d / 1000000,
                grid: true,
                tickFormat: (f => `${f}M`),
                domain: [0, 4],
            },
            marks: [
                Plot.line(CCScanner_downloads_plot, {
                    x: "date", 
                    y: "downloads",
                    stroke: "#ec025f",
                    strokeWidth: 3
                }),
                Plot.ruleY([0]),
            ],
        })
        );

        CoronaCheck_downloads_plot_code.value = CoronaCheck_downloads_plot.getElementsByTagName('svg')[0].innerHTML;
        CoronaCheck_downloads_plot_EN_code.value = CoronaCheck_downloads_plot_EN.getElementsByTagName('svg')[0].innerHTML;

        CoronaCheckScanner_downloads_plot_code.value = CoronaCheckScanner_downloads_plot.getElementsByTagName('svg')[0].innerHTML;
        CoronaCheckScanner_downloads_plot_EN_code.value = CoronaCheckScanner_downloads_plot_EN.getElementsByTagName('svg')[0].innerHTML;
    </script>
</body>
</html>
